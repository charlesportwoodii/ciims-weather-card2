(function(){new CardPrototype({name:"WeatherCard",openStreetMapURL:"https://nominatim.openstreetmap.org/reverse?format=json&zoom=18",openWeatherApiURL:"http://api.openweathermap.org/data/2.5/weather",init:function(){this.getGeoLoc()},getGeoLoc:function(){var t=this,e=new Date,a=t.getLocalStorageItem(t,"lat/lng");null==a||a.timestamp+6e5<e.getTime()?navigator.geolocation.getCurrentPosition(function(a){var o=parseFloat(a.coords.latitude).toFixed(2),n=parseFloat(a.coords.longitude).toFixed(2);t.setLocalStorageItem(t,"lat/lng",{lat:o,lng:n,timestamp:e.getTime()}),t.foundLocation(t,o,n)}):t.foundLocation(t,a.lat,a.lng)},foundLocation:function(t,e,a){t.getLocationData(t,e,a),t.getWeatherData(t,e,a)},getLocationData:function(t,e,a){var o=t.getLocalStorageItem(t,e+"/"+a+"-location");null==o?$.get(t.openStreetMapURL+"&lat="+e+"&lon="+a,function(o){t.setLocalStorageItem(t,e+"/"+a+"-location",o.address),t.setLocationData(t,o.address)}):t.setLocationData(t,o)},setLocationData:function(t,e){console.log(e)},getWeatherData:function(t,e,a){var o=t.getLocalStorageItem(t,e+"/"+a+"-weather");null==o?$.ajax({url:window.location.origin+"/api/default/jsonProxy",type:"POST",headers:CiiMSDashboard.getRequestHeaders(),data:{url:t.openWeatherApiURL+"?lat="+e+"&lon="+a},beforeSend:CiiMSDashboard.ajaxBeforeSend(),success:function(n){o=n.response,t.setLocalStorageItem(t,e+"/"+a+"-weather",o),t.setWeatherData(t,o)}}):t.setWeatherData(t,o)},setWeatherData:function(t,e){console.log(e)},getLocalStorageItem:function(t,e){return JSON.parse(localStorage.getItem(t.name+"/"+e))},setLocalStorageItem:function(t,e,a){return localStorage.setItem(t.name+"/"+e,JSON.stringify(a))}})})(this);